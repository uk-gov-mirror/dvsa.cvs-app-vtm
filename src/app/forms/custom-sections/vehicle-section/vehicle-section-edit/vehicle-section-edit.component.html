<div [formGroup]="form">
  <!--  Vehicle Type -->
  <div *ngIf="shouldDisplayFormControl('techRecord_vehicleType')" class="govuk-form-group-input">
    <h1>
      <label tag for="techRecord_vehicleType"> Vehicle type <div>
        <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
      </div></label>
    </h1>
    <input id="techRecord_vehicleType" [width]="FormNodeWidth.XS" govukInput formControlName="techRecord_vehicleType" />
  </div>

  <!--  Date of First Registration -->
  <app-date-controls *ngIf="shouldDisplayFormControl('techRecord_regnDate')" formControlName="techRecord_regnDate" #dateFirstReg>
    <div class="govuk-form-group-date" [formGroup]="dateFirstReg.form">
      <fieldset role="group">
        <legend>
          Date of first registration
          <app-tag [type]="TagType.PURPLE">{{ TagTypeLabels.PLATES }}</app-tag>
        </legend>
        <app-control-errors elementId="techRecord_regnDate-error" [control]="$any(form.controls.techRecord_regnDate)" />
        <div id="techRecord_regnDate">
          <div>
            <div>
              <label id="techRecord_regnDate-day-label" for="techRecord_regnDate-day">Day</label>
              <input class="govuk-input--width-2" govukDateInput="techRecord_regnDate" formControlName="day" />
            </div>
          </div>
          <div>
            <div>
              <label id="techRecord_regnDate-month-label" for="techRecord_regnDate-month">Month</label>
              <input class="govuk-input--width-2" govukDateInput="techRecord_regnDate" formControlName="month" />
            </div>
          </div>
          <div>
            <div>
              <label id="techRecord_regnDate-year-label" for="techRecord_regnDate-year">Year</label>
              <input class="govuk-input--width-4" govukDateInput="techRecord_regnDate" formControlName="year" />
            </div>
          </div>
        </div>
      </fieldset>
    </div>
  </app-date-controls>

  <!--  Month of manufacture (TRL Only) -->
  <div *ngIf="shouldDisplayFormControl('techRecord_manufactureMonth')" class="govuk-form-group-select">
    <label>
      Month of manufacture
    </label>
    <app-control-errors elementId="techRecord_manufactureMonth" [control]="$any(form.get('techRecord_manufactureMonth'))" />
    <select govukSelect formControlName="techRecord_manufactureMonth">
      <option [value]="option.value" *ngFor="let option of MONTHS">{{ option.label }}</option>
    </select>
  </div>

  <!--  Year of manufacture -->
  <div *ngIf="shouldDisplayFormControl('techRecord_manufactureYear')" class="govuk-form-group-input">
    <h1>
      <label tag id="techRecord_manufactureYear-label">
        Year of manufacture
        <div>
          <app-tag [type]="TagType.PURPLE">{{ TagTypeLabels.PLATES }}</app-tag>
        </div>
      </label>
    </h1>
    <app-control-errors elementId="techRecord_manufactureYear" [control]="$any(form.get('techRecord_manufactureYear'))" />
    <input
      appNumberOnly
      inputmode="numeric"
      type="number"
      [width]="FormNodeWidth.XS"
      govukInput
      formControlName="techRecord_manufactureYear" />
  </div>

  <!--  Date of first use (TRL only) -->
  <app-date-controls *ngIf="shouldDisplayFormControl('techRecord_firstUseDate')" formControlName="techRecord_firstUseDate" #firstUseDate>
    <div class="govuk-form-group-date" [formGroup]="firstUseDate.form">
      <fieldset role="group">
        <legend>
          Date of first use
        </legend>
        <app-control-errors elementId="techRecord_firstUseDate-error" [control]="$any(form.get('techRecord_firstUseDate'))" />
        <div id="techRecord_firstUseDate">
          <div>
            <div>
              <label id="techRecord_firstUseDate-day-label" for="techRecord_firstUseDate-day">Day</label>
              <input class="govuk-input--width-2" govukDateInput="techRecord_firstUseDate" formControlName="day" />
            </div>
          </div>
          <div>
            <div>
              <label id="techRecord_firstUseDate-month-label" for="techRecord_firstUseDate-month">Month</label>
              <input class="govuk-input--width-2" govukDateInput="techRecord_firstUseDate" formControlName="month" />
            </div>
          </div>
          <div>
            <div>
              <label id="techRecord_firstUseDate-year-label" for="techRecord_firstUseDate-year">Year</label>
              <input class="govuk-input--width-4" govukDateInput="techRecord_firstUseDate" formControlName="year" />
            </div>
          </div>
        </div>
      </fieldset>
    </div>
  </app-date-controls>

  <!--  Number of axles -->
  <div *ngIf="shouldDisplayFormControl('techRecord_noOfAxles')" class="govuk-form-group-input">
    <h1>
      <label tag for="techRecord_noOfAxles"> Number of axles
        <div>
          <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
        </div>
      </label>
    </h1>
    <input appNumberOnly type="number" inputmode="numeric" id="techRecord_noOfAxles" [value]="techRecord().techRecord_noOfAxles" [width]="FormNodeWidth.XXS" govukInput formControlName="techRecord_noOfAxles" />
  </div>

  <!-- Vehicle Subclass (LGV/CAR/Small TRL only) -->
  <ng-container *ngIf="shouldShowSubclass">
    <govuk-checkbox-group
      *ngIf="shouldDisplayFormControl('techRecord_vehicleSubclass')"
      label="Vehicle subclass"
      formControlName="techRecord_vehicleSubclass"
      [options]="VEHICLE_SUBCLASS_OPTIONS"
      [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
    ></govuk-checkbox-group>
  </ng-container>

  <div class="flex-row">
    <!-- Speed limiter exempt for HGV (required to generate plates) -->
    <govuk-form-group-radio
      *ngIf="techRecord().techRecord_vehicleType === VehicleTypes.HGV"
      label="Speed limiter exempt"
      formControlName="techRecord_speedLimiterMrk"
      [options]="EXEMPT_OR_NOT_OPTIONS"
      [tags]="[{ colour: TagType.PURPLE, label: TagTypeLabels.PLATES }]"
    ></govuk-form-group-radio>

    <!-- Speed limiter exempt for PSV -->
    <govuk-form-group-radio
      *ngIf="techRecord().techRecord_vehicleType === VehicleTypes.PSV"
      label="Speed limiter exempt"
      formControlName="techRecord_speedLimiterMrk"
      [options]="EXEMPT_OR_NOT_OPTIONS"
    ></govuk-form-group-radio>

    <!-- Tacho exempt -->
    <govuk-form-group-radio
      *ngIf="shouldDisplayFormControl('techRecord_tachoExemptMrk')"
      label="Tacho exempt"
      formControlName="techRecord_tachoExemptMrk"
      [options]="EXEMPT_OR_NOT_OPTIONS"
    ></govuk-form-group-radio>
  </div>

  <!-- Euro standard -->
  <govuk-form-group-radio
    *ngIf="shouldDisplayFormControl('techRecord_euroStandard')"
    label="Euro standard"
    formControlName="techRecord_euroStandard"
    [options]="EMISSION_STANDARD_OPTIONS"
  ></govuk-form-group-radio>

  <!-- Road friendly suspension -->
  <govuk-form-group-radio
    *ngIf="shouldDisplayFormControl('techRecord_roadFriendly')"
    label="Road friendly suspension"
    formControlName="techRecord_roadFriendly"
    [options]="YES_NO_OPTIONS"
    [tags]="[{ colour: TagType.PURPLE, label: TagTypeLabels.PLATES }]"
  ></govuk-form-group-radio>

  <!--  Suspension type (TRL Only) -->
  <div class="govuk-form-group-select" *ngIf="shouldDisplayFormControl('techRecord_suspensionType')">
    <label>
      Suspension type (optional)
    </label>
    <app-control-errors elementId="techRecord_suspensionType" [control]="$any(form.get('techRecord_suspensionType'))" />
    <select govukSelect formControlName="techRecord_suspensionType">
      <option [value]="option.value" *ngFor="let option of SUSPENSION_TYRE_OPTIONS">{{ option.label }}</option>
    </select>
  </div>

  <!-- Fuel / propulsion system -->
  <div *ngIf="shouldDisplayFormControl('techRecord_fuelPropulsionSystem')" class="govuk-form-group-select">
    <label> Fuel / propulsion system </label>
    <app-control-errors elementId="techRecord_fuelPropulsionSystem" [control]="$any(form.get('techRecord_fuelPropulsionSystem'))" />
    <select govukSelect formControlName="techRecord_fuelPropulsionSystem">
      <option [value]="option.value" *ngFor="let option of FUEL_PROPULSION_SYSTEM_OPTIONS">{{ option.label }}</option>
    </select>
  </div>

  <!-- Drawbar coupling fitted -->
  <govuk-form-group-radio
    *ngIf="shouldDisplayFormControl('techRecord_drawbarCouplingFitted')"
    label="Drawbar coupling fitted"
    formControlName="techRecord_drawbarCouplingFitted"
    [options]="YES_NO_OPTIONS"
  ></govuk-form-group-radio>

  <!--  Vehicle class (HGV/Motorcycle/Small TRL/TRL Only) -->
  <ng-container *ngIf="shouldShowClass">
    <ng-container *ngIf="shouldDisplayFormControl('techRecord_vehicleClass_description')" [ngTemplateOutlet]="vehicleClass"></ng-container>
  </ng-container>

  <!--  Coupling type (TRL Only) -->
  <div class="govuk-form-group-select" *ngIf="shouldDisplayFormControl('techRecord_couplingType')">
    <label>
      Coupling type (optional)
    </label>
    <app-control-errors elementId="techRecord_couplingType" [control]="$any(form.get('techRecord_couplingType'))" />
    <select govukSelect formControlName="techRecord_couplingType">
      <option [value]="option.value" *ngFor="let option of CouplingTypeOptions">{{ option.label }}</option>
    </select>
  </div>

  <!--  Max load on coupling (TRL Only) -->
  <div *ngIf="shouldDisplayFormControl('techRecord_maxLoadOnCoupling')" class="govuk-form-group-input">
    <h1>
      <label id="techRecord_maxLoadOnCoupling-label">
        Max load on coupling (optional)
        <div>
          <app-tag [type]="TagType.PURPLE">{{ TagTypeLabels.PLATES }}</app-tag>
        </div>
      </label>
    </h1>
    <input
      appNumberOnly
      inputmode="numeric"
      type="number"
      [width]="FormNodeWidth.XS"
      govukInput
      formControlName="techRecord_maxLoadOnCoupling" />
  </div>


  <!--  Vehicle configuration-->
  <div *ngIf="shouldDisplayFormControl('techRecord_vehicleConfiguration')" class="govuk-form-group-select">
    <label tag>
      Vehicle configuration
      <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
      <app-tag [type]="TagType.PURPLE">{{ TagTypeLabels.PLATES }}</app-tag>
    </label>
    <app-control-errors elementId="techRecord_vehicleConfiguration" [control]="$any(form.get('techRecord_vehicleConfiguration'))" />
    <select govukSelect formControlName="techRecord_vehicleConfiguration">
      <option [value]="option.value" *ngFor="let option of vehicleConfigurationOptions">{{ option.label }}</option>
    </select>
  </div>

<!-- Off road vehicle -->
  <govuk-form-group-radio
    *ngIf="shouldDisplayFormControl('techRecord_offRoad')"
    label="Off road vehicle"
    formControlName="techRecord_offRoad"
    [options]="YES_NO_OPTIONS"
  ></govuk-form-group-radio>

  <!-- Frame description (TRL Only) -->
  <div *ngIf="shouldDisplayFormControl('techRecord_frameDescription')" class="govuk-form-group-select">
    <label tag>
      Frame description (optional)
    </label>
    <app-control-errors elementId="techRecord_frameDescription" [control]="$any(form.get('techRecord_frameDescription'))" />
    <select govukSelect formControlName="techRecord_frameDescription">
      <option [value]="option.value" *ngFor="let option of FRAME_DESCRIPTION_OPTIONS">{{ option.label }}</option>
    </select>
  </div>

  <!-- EU Category -->
  <div *ngIf="shouldDisplayFormControl('techRecord_euVehicleCategory')" class="govuk-form-group-select">
    <label>EU vehicle category</label>
    <app-control-errors elementId="techRecord_euVehicleCategory" [control]="$any(form.get('techRecord_euVehicleCategory'))" />
    <select govukSelect [width]="FormNodeWidth.XXS" formControlName="techRecord_euVehicleCategory">
      <option [value]="option.value" *ngFor="let option of EUCategoryOptions">{{ option.label }}</option>
    </select>
  </div>

  <!-- Number of wheels (Motorcycle only) -->
  <ng-container *ngIf="getVehicleType() === VehicleTypes.MOTORCYCLE">
    <div *ngIf="shouldDisplayFormControl('techRecord_numberOfWheelsDriven')" class="govuk-form-group-input">
      <h1>
        <label tag for="techRecord_numberOfWheelsDriven"> Number of wheels <div>
          <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
        </div></label>
      </h1>
      <input id="techRecord_numberOfWheelsDriven" [width]="FormNodeWidth.XXS" govukInput formControlName="techRecord_numberOfWheelsDriven" />
    </div>
  </ng-container>

  <!-- Emission Limit -->
  <div *ngIf="shouldDisplayFormControl('techRecord_emissionsLimit')" class="govuk-form-group-input">
    <h1>
      <label tag for="techRecord_emissionsLimit">Emission limit (m-1) (plate value)</label>
    </h1>
    <app-control-errors elementId="techRecord_emissionsLimit" [control]="$any(form.get('techRecord_emissionsLimit'))" />
    <input type="number" spellcheck="false" id="techRecord_emissionsLimit" [width]="FormNodeWidth.XXS" govukInput formControlName="techRecord_emissionsLimit" />
  </div>

  <!-- PSV Only Fields -->
  <div class="govuk-form-group-split-controls" *ngIf="getVehicleType() === VehicleTypes.PSV">
    <h1>
      <label>Seats:</label>
    </h1>
    <div class="flex-row">
      <!-- Upper Deck -->
      <div class="govuk-form-group-input">
        <h1>
          <label tag for="techRecord_seatsUpperDeck">
            Upper deck
            <div>
              <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
            </div>
          </label>
        </h1>
        <app-control-errors elementId="techRecord_seatsUpperDeck" [control]="$any(form.get('techRecord_seatsUpperDeck'))" />
        <input appNumberOnly inputmode="numeric" type="number" spellcheck="false" id="techRecord_seatsUpperDeck" [width]="FormNodeWidth.XS" govukInput formControlName="techRecord_seatsUpperDeck" />
      </div>

      <!-- Lower Deck -->
      <div class="govuk-form-group-input">
        <h1>
          <label tag for="techRecord_seatsLowerDeck">
            Lower deck
            <div>
              <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
            </div>
          </label>
        </h1>
        <app-control-errors elementId="techRecord_seatsLowerDeck" [control]="$any(form.get('techRecord_seatsLowerDeck'))" />
        <input appNumberOnly inputmode="numeric" type="number" spellcheck="false" id="techRecord_seatsLowerDeck" [width]="FormNodeWidth.XS" govukInput formControlName="techRecord_seatsLowerDeck" />
      </div>
    </div>

    <!-- Standing Capacity -->
    <div class="govuk-form-group-input">
      <h1>
        <label tag for="techRecord_standingCapacity">Standing capacity</label>
      </h1>
      <app-control-errors elementId="techRecord_standingCapacity" [control]="$any(form.get('techRecord_standingCapacity'))" />
      <input type="number" spellcheck="false" id="techRecord_standingCapacity" [width]="FormNodeWidth.XXS" govukInput formControlName="techRecord_standingCapacity" />
    </div>

    <!-- Vehicle Class (PSV) -->
    <ng-template [ngTemplateOutlet]="vehicleClass"></ng-template>

    <!--  Vehicle Size -->
    <govuk-form-group-radio
      *ngIf="shouldDisplayFormControl('techRecord_vehicleSize')"
      label="Vehicle size"
      formControlName="techRecord_vehicleSize"
      [options]="VEHICLE_SIZE_OPTIONS"
      [tags]="[{ colour: TagType.RED, label: TagTypeLabels.REQUIRED }]"
      [hint]="'The Vehicle Size is calculated automatically based on the number of seats and standing capacity. Only change the Size if you need to'"
    >
    </govuk-form-group-radio>

    <!--  Number of Seatbelts -->
    <div class="govuk-form-group-input" *ngIf="shouldDisplayFormControl('techRecord_numberOfSeatbelts')">
      <h1>
        <label tag for="techRecord_numberOfSeatbelts">Number of seat belts</label>
      </h1>
      <app-control-errors elementId="techRecord_numberOfSeatbelts" [control]="$any(form.get('techRecord_numberOfSeatbelts'))" />
      <input type="number" spellcheck="false" id="techRecord_numberOfSeatbelts" [width]="FormNodeWidth.XXS" govukInput formControlName="techRecord_numberOfSeatbelts" />
    </div>

    <!--  Seatbelt installation approval date / type approved -->
    <app-date-controls *ngIf="shouldDisplayFormControl('techRecord_seatbeltInstallationApprovalDate')" formControlName="techRecord_seatbeltInstallationApprovalDate" #seatbeltInstallationDate>
      <div class="govuk-form-group-date" [formGroup]="seatbeltInstallationDate.form">
        <fieldset role="group">
          <legend>
            Seatbelt installation approval date / type approved
          </legend>
          <app-control-errors elementId="techRecord_seatbeltInstallationApprovalDate-error" [control]="$any(form.get('techRecord_seatbeltInstallationApprovalDate'))" />
          <div id="techRecord_seatbeltInstallationApprovalDate">
            <div>
              <div>
                <label id="techRecord_seatbeltInstallationApprovalDate-day-label" for="techRecord_seatbeltInstallationApprovalDate-day">Day</label>
                <input class="govuk-input--width-2" govukDateInput="techRecord_seatbeltInstallationApprovalDate" formControlName="day" />
              </div>
            </div>
            <div>
              <div>
                <label id="techRecord_seatbeltInstallationApprovalDate-month-label" for="techRecord_seatbeltInstallationApprovalDate-month">Month</label>
                <input class="govuk-input--width-2" govukDateInput="techRecord_seatbeltInstallationApprovalDate" formControlName="month" />
              </div>
            </div>
            <div>
              <div>
                <label id="techRecord_seatbeltInstallationApprovalDate-year-label" for="techRecord_seatbeltInstallationApprovalDate-year">Year</label>
                <input class="govuk-input--width-4" govukDateInput="techRecord_seatbeltInstallationApprovalDate" formControlName="year" />
              </div>
            </div>
          </div>
        </fieldset>
      </div>
    </app-date-controls>
  </div>

  <!-- Departmental vehicle marker -->
  <govuk-form-group-radio
    *ngIf="shouldDisplayFormControl('techRecord_departmentalVehicleMarker')"
    label="Departmental vehicle marker"
    formControlName="techRecord_departmentalVehicleMarker"
    [options]="YES_NO_OPTIONS"
  ></govuk-form-group-radio>

  <!-- Alteration marker -->
  <govuk-form-group-radio
    *ngIf="shouldDisplayFormControl('techRecord_alterationMarker')"
    label="Alteration marker"
    formControlName="techRecord_alterationMarker"
    [options]="YES_NO_OPTIONS"
  ></govuk-form-group-radio>

  <ng-template #vehicleClass>
    <div  class="govuk-form-group-select">
      <label tag>
        Vehicle class
        <app-tag [type]="TagType.RED">{{ TagTypeLabels.REQUIRED }}</app-tag>
      </label>
      <div *ngIf="getVehicleType() === VehicleTypes.PSV" class="govuk-hint">
        The Vehicle Class is calculated automatically based on the number of seats and standing capacity.
        Only change the Class if you need to
      </div>
      <app-control-errors elementId="techRecord_vehicleClass_description" [control]="$any(form.get('techRecord_vehicleClass_description'))" />
      <select govukSelect formControlName="techRecord_vehicleClass_description">
        <option [value]="option.value" *ngFor="let option of vehicleClassDescriptionOptions">{{ option.label }}</option>
      </select>
    </div>
  </ng-template>
</div>
