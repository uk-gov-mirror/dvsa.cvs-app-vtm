<div [formGroup]="form">
  <!--  Vehicle Type -->
  @if (shouldDisplayFormControl('techRecord_vehicleType')) {
    <govuk-form-group-input
      label="Vehicle type"
      [width]="getVehicleType() === VehicleTypes.MOTORCYCLE ? FormNodeWidth.M : FormNodeWidth.XS"
      [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
      formControlName="techRecord_vehicleType"
    ></govuk-form-group-input>
  }

  <!--  Date of First Registration -->
  @if (shouldDisplayFormControl('techRecord_regnDate')) {
    <govuk-form-group-date
      label="Date of first registration"
      [tags]="shouldShowPlatesHgv ? [{ label: TagTypeLabels.PLATES, colour: TagType.PURPLE }] : []"
      formControlName="techRecord_regnDate"
    ></govuk-form-group-date>
  }

  <!--  Month of manufacture (TRL Only) -->
  @if (shouldDisplayFormControl('techRecord_manufactureMonth')) {
    <govuk-form-group-select
      label="Month of manufacture"
      formControlName="techRecord_manufactureMonth"
      [options]="MONTHS"
      [allowNull]="true"
    ></govuk-form-group-select>
  }

  <!--  Year of manufacture -->
  @if (shouldDisplayFormControl('techRecord_manufactureYear')) {
    <govuk-form-group-input
      label="Year of manufacture"
      formControlName="techRecord_manufactureYear"
      [width]="FormNodeWidth.XS"
      type="number"
      [tags]="shouldShowPlatesHgv || shouldShowPlatesTrl ? [{ label: TagTypeLabels.PLATES, colour: TagType.PURPLE }] : []"
    ></govuk-form-group-input>
  }

  <!--  Date of first use (TRL only) -->
  @if (shouldDisplayFormControl('techRecord_firstUseDate')) {
    <govuk-form-group-date
      label="Date of first use"
      formControlName="techRecord_firstUseDate"
    ></govuk-form-group-date>
  }

  <!--  Number of axles -->
  <govuk-form-group-input
    type="number"
    label="Number of axles"
    [width]="FormNodeWidth.XXS"
    [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
    [value]="techRecord().techRecord_noOfAxles"
    formControlName="techRecord_noOfAxles"
  ></govuk-form-group-input>

  @if (getVehicleType() === VehicleTypes.HGV || getVehicleType() === VehicleTypes.PSV) {
    <div class="flex-row">
      <!-- Speed limiter exempt for HGV (required to generate plates) -->
      @if (techRecord().techRecord_vehicleType === VehicleTypes.HGV) {
        <govuk-form-group-radio
          label="Speed limiter exempt"
          formControlName="techRecord_speedLimiterMrk"
          [options]="EXEMPT_OR_NOT_OPTIONS"
          [tags]="shouldShowPlatesHgv || shouldShowPlatesTrl ? [{ colour: TagType.PURPLE, label: TagTypeLabels.PLATES }] : []"
        ></govuk-form-group-radio>
      }
      <!-- Speed limiter exempt for PSV -->
      @if (techRecord().techRecord_vehicleType === VehicleTypes.PSV) {
        <govuk-form-group-radio
          label="Speed limiter exempt"
          formControlName="techRecord_speedLimiterMrk"
          [options]="EXEMPT_OR_NOT_OPTIONS"
        ></govuk-form-group-radio>
      }
      <!-- Tacho exempt -->
      @if (shouldDisplayFormControl('techRecord_tachoExemptMrk')) {
        <govuk-form-group-radio
          label="Tacho exempt"
          formControlName="techRecord_tachoExemptMrk"
          [options]="EXEMPT_OR_NOT_OPTIONS"
        ></govuk-form-group-radio>
      }
    </div>
  }

  <!-- Euro standard -->
  @if (shouldDisplayFormControl('techRecord_euroStandard')) {
    <govuk-form-group-radio
      label="Euro standard"
      formControlName="techRecord_euroStandard"
      [options]="EMISSION_STANDARD_OPTIONS"
    ></govuk-form-group-radio>
  }

  <!-- Road friendly suspension -->
  @if (shouldDisplayFormControl('techRecord_roadFriendly')) {
    <govuk-form-group-radio
      label="Road friendly suspension"
      formControlName="techRecord_roadFriendly"
      [options]="YES_NO_OPTIONS"
      [tags]="shouldShowPlatesHgv || shouldShowPlatesTrl ? [{ colour: TagType.PURPLE, label: TagTypeLabels.PLATES }] : []"
    ></govuk-form-group-radio>
  }

  <!--  Suspension type (TRL Only) -->
  @if (shouldDisplayFormControl('techRecord_suspensionType')) {
    <govuk-form-group-select
      label="Suspension type (optional)"
      formControlName="techRecord_suspensionType"
      [options]="SUSPENSION_TYRE_OPTIONS"
      [allowNull]="true"
    ></govuk-form-group-select>
  }

  <!-- Fuel / propulsion system -->
  @if (shouldDisplayFormControl('techRecord_fuelPropulsionSystem')) {
    <govuk-form-group-select
      label="Fuel / propulsion system"
      formControlName="techRecord_fuelPropulsionSystem"
      [options]="FUEL_PROPULSION_SYSTEM_OPTIONS"
      [allowNull]="true"
    ></govuk-form-group-select>
  }

  <!-- Drawbar coupling fitted -->
  @if (shouldDisplayFormControl('techRecord_drawbarCouplingFitted')) {
    <govuk-form-group-radio
      label="Drawbar coupling fitted"
      formControlName="techRecord_drawbarCouplingFitted"
      [options]="YES_NO_OPTIONS"
    ></govuk-form-group-radio>
  }

  @if (getVehicleType() !== VehicleTypes.PSV) {
    <ng-container [ngTemplateOutlet]="euVehicleCategory"></ng-container>
  }

  <!--  Vehicle class (HGV/Motorcycle/Small TRL/TRL Only) -->
  @if (shouldShowClass) {
    @if (shouldDisplayFormControl('techRecord_vehicleClass_description')) {
      <ng-container [ngTemplateOutlet]="vehicleClass"></ng-container>
    }
  }

  <!-- Vehicle Subclass (LGV/CAR/Small TRL only) -->
  @if (shouldShowSubclass && shouldDisplayFormControl('techRecord_vehicleSubclass')) {
    <govuk-checkbox-group
      label="Vehicle subclass"
      formControlName="techRecord_vehicleSubclass"
      [options]="VEHICLE_SUBCLASS_OPTIONS"
      [tags]="getVehicleType() !== VehicleTypes.SMALL_TRL ? [{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }] : []"
    ></govuk-checkbox-group>
  }

  <!--  Coupling type (TRL Only) -->
  @if (shouldDisplayFormControl('techRecord_couplingType')) {
    <govuk-form-group-select
      label="Coupling type (optional)"
      [options]="CouplingTypeOptions"
      formControlName="techRecord_couplingType"
      [allowNull]="true"
    ></govuk-form-group-select>
  }

  <!--  Max load on coupling (TRL Only) -->
  @if (shouldDisplayFormControl('techRecord_maxLoadOnCoupling')) {
    <govuk-form-group-input
      label="Max load on coupling (optional)"
      formControlName="techRecord_maxLoadOnCoupling"
      type="number"
      [width]="FormNodeWidth.M"
      [tags]="[{ colour: TagType.PURPLE, label: TagTypeLabels.PLATES }]"
    ></govuk-form-group-input>
  }

  <!-- Vehicle configuration-->
  @if (shouldDisplayFormControl('techRecord_vehicleConfiguration')) {
    @if ((shouldShowPlatesHgv || shouldShowPlatesTrl)) {
      <govuk-form-group-select
        label="Vehicle configuration"
        [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }, { label: TagTypeLabels.PLATES, colour: TagType.PURPLE }]"
        [options]="vehicleConfigurationOptions"
        formControlName="techRecord_vehicleConfiguration"
        [allowNull]="true"
      ></govuk-form-group-select>
    } @else {
      <govuk-form-group-select
        label="Vehicle configuration"
        [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
        [options]="vehicleConfigurationOptions"
        formControlName="techRecord_vehicleConfiguration"
        [allowNull]="true"
      ></govuk-form-group-select>
    }
  }

  <!-- Off road vehicle -->
  @if (shouldDisplayFormControl('techRecord_offRoad')) {
    <govuk-form-group-radio
      label="Off road vehicle"
      formControlName="techRecord_offRoad"
      [options]="YES_NO_OPTIONS"
    ></govuk-form-group-radio>
  }

  <!-- Frame description (TRL Only) -->
  @if (shouldDisplayFormControl('techRecord_frameDescription')) {
    <govuk-form-group-select
      label="Frame description (optional)"
      formControlName="techRecord_frameDescription"
      [options]="FRAME_DESCRIPTION_OPTIONS"
      [allowNull]="true"
    ></govuk-form-group-select>
  }

  <!-- Number of wheels (Motorcycle only) -->
  @if (getVehicleType() === VehicleTypes.MOTORCYCLE &&
    shouldDisplayFormControl('techRecord_numberOfWheelsDriven')) {
    <govuk-form-group-input
      type="number"
      label="Number of wheels"
      [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
      formControlName="techRecord_numberOfWheelsDriven"
      [width]="FormNodeWidth.XXS"
    ></govuk-form-group-input>
  }

  <!-- Emission Limit -->
  @if (shouldDisplayFormControl('techRecord_emissionsLimit')) {
    <govuk-form-group-input
      label="Emission limit (m-1) (plate value)"
      formControlName="techRecord_emissionsLimit"
      type="decimal"
      [width]="FormNodeWidth.XXS"
    ></govuk-form-group-input>
  }

  <!-- PSV Only Fields -->
  @if (getVehicleType() === VehicleTypes.PSV) {
    <div>
      <h1>
        <label class="govuk-label govuk-label--m">Seats:</label>
      </h1>
      <div class="flex-row govuk-form-group-split-controls">
        <!-- Upper Deck -->
        <govuk-form-group-input
          label="Upper deck"
          [width]="FormNodeWidth.M"
          [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
          formControlName="techRecord_seatsUpperDeck"
          type="number"
        ></govuk-form-group-input>
        <!-- Lower Deck -->
        <govuk-form-group-input
          label="Lower deck"
          [width]="FormNodeWidth.M"
          [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
          formControlName="techRecord_seatsLowerDeck"
          type="number"
        ></govuk-form-group-input>
      </div>
      <!-- Standing Capacity -->
      <govuk-form-group-input
        label="Standing capacity"
        formControlName = 'techRecord_standingCapacity'
        type="number"
        [width]="FormNodeWidth.XXS"
      ></govuk-form-group-input>
      <!-- Vehicle Class (PSV) -->
      @if (getVehicleType() === VehicleTypes.PSV) {
        <ng-container [ngTemplateOutlet]="euVehicleCategory"></ng-container>
      }
      <ng-template [ngTemplateOutlet]="vehicleClass"></ng-template>
      <!--  Vehicle Size -->
      @if (shouldDisplayFormControl('techRecord_vehicleSize')) {
        <govuk-form-group-radio
          label="Vehicle size"
          formControlName="techRecord_vehicleSize"
          [options]="VEHICLE_SIZE_OPTIONS"
          [tags]="[{ colour: TagType.RED, label: TagTypeLabels.REQUIRED }]"
          [hint]="'The Vehicle Size is calculated automatically based on the number of seats and standing capacity. Only change the Size if you need to'"
          >
        </govuk-form-group-radio>
      }
      <!--  Number of Seatbelts -->
      <govuk-form-group-input
        label="Number of seat belts"
        formControlName="techRecord_numberOfSeatbelts"
        type="numericString"
        [width]="FormNodeWidth.XXS"
      ></govuk-form-group-input>
      <!-- Seatbelt installation approval date / type approved -->
      @if (shouldDisplayFormControl('techRecord_seatbeltInstallationApprovalDate')) {
        <govuk-form-group-date
          label="Seatbelt installation approval date / type approved"
          formControlName="techRecord_seatbeltInstallationApprovalDate"
        ></govuk-form-group-date>
      }
    </div>
  }

  <!-- Departmental vehicle marker -->
  @if (shouldDisplayFormControl('techRecord_departmentalVehicleMarker')) {
    <govuk-form-group-radio
      label="Departmental vehicle marker"
      formControlName="techRecord_departmentalVehicleMarker"
      [options]="YES_NO_OPTIONS"
    ></govuk-form-group-radio>
  }

  <!-- Alteration marker -->
  @if (shouldDisplayFormControl('techRecord_alterationMarker')) {
    <govuk-form-group-radio
      label="Alteration marker"
      formControlName="techRecord_alterationMarker"
      [options]="YES_NO_OPTIONS"
    ></govuk-form-group-radio>
  }

  <ng-template #euVehicleCategory>
    <!-- EU Category -->
    @if (shouldDisplayFormControl('techRecord_euVehicleCategory')) {
      <govuk-form-group-select
        label="EU vehicle category"
        formControlName="techRecord_euVehicleCategory"
        [width]="FormNodeWidth.S"
        [options]="EUCategoryOptions"
        [tags]="getVehicleType() === VehicleTypes.SMALL_TRL ? [{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }] : []"
        [allowNull]="true"
      ></govuk-form-group-select>
    }
  </ng-template>

  <ng-template #vehicleClass>
    <govuk-form-group-select
      label="Vehicle class"
      [tags]="[{ label: TagTypeLabels.REQUIRED, colour: TagType.RED }]"
      [hint]="vehicleClassHint"
      formControlName="techRecord_vehicleClass_description"
      [options]="vehicleClassDescriptionOptions ?? []"
      [allowNull]="true"
    ></govuk-form-group-select>
  </ng-template>
</div>
